name: Refresh Hauler Testdata

on:
  workflow_dispatch:

jobs:
  refresh-testdata:
    name: Refresh Hauler Testdata
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Clean Up Actions Tools Cache
        run: rm -rf /opt/hostedtoolcache

      - name: Checkout Repository
        uses: actions/checkout@v6.0.1

      - name: Fetch Hauler Binary
        run: curl -sfL https://get.hauler.dev | bash

      - name: Login to GitHub Container Registry and Docker Hub Container Registry
        run: |
          hauler login ghcr.io --username ${{ github.repository_owner }} --password ${{ secrets.GITHUB_TOKEN }}
          hauler login docker.io --username ${{ secrets.DOCKERHUB_USERNAME }} --password ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Process Images for Tests
        run: |
          hauler store add image nginx:1.25-alpine
          hauler store add image nginx:1.26-alpine
          hauler store add image busybox
          hauler store add image busybox:stable
          hauler store add image gcr.io/distroless/base
          hauler store add image gcr.io/distroless/base@sha256:7fa7445dfbebae4f4b7ab0e6ef99276e96075ae42584af6286ba080750d6dfe5

      - name: Push Store Contents to Hauler-Dev GitHub Container Registry
        run: |
          hauler store copy registry://ghcr.io/${{ github.repository_owner }}

      - name: Verify Hauler Store Contents
        run: hauler store info
